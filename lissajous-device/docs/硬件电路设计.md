# 李萨如图形演示装置 - 硬件电路设计

## 1. 整体电路架构

```
输入信号 → 信号调理 → 频率检测 → PLL倍频 → 幅度控制 → 波形变换 → 输出
    ↓         ↓         ↓        ↓        ↓         ↓         ↓
   缓冲     电平转换   Timer_A   CD4046   MCP4018T  积分器    Y轴
                                                    
相位检测 ← 过零检测 ← 比较器 ← 信号整形
    ↓
MSP430 ← ADC采样 ← X轴信号
    ↓
128×64 LCD 显示
```

## 2. 核心电路模块设计

### 2.1 输入信号调理电路

#### 2.1.1 信号缓冲与电平转换
```
输入信号(2Vpp) → 电阻分压 → 电平偏移 → ADC输入(0-3.3V)
                  (R1,R2)    (运放跟随器)
```

**电路参数:**
- R1 = 10kΩ, R2 = 10kΩ (分压比1:1)
- 偏置电压 = 1.65V (VCC/2)
- 输出范围: 0.65V ~ 2.65V (满足ADC输入范围)

```
输入信号 → [R1=10kΩ] → [LM324A] → ADC_IN
            ↓
         [R2=10kΩ]
            ↓
          1.65V偏置
```

#### 2.1.2 过零检测电路
```
输入信号 → [比较器LM324B] → 数字信号 → MSP430 GPIO
            ↑
        参考电压(1.65V)
```

### 2.2 PLL频率合成电路 (CD4046)

#### 2.2.1 CD4046配置
```
参考输入(fin) → [相位比较器1] → [环路滤波器] → [VCO] → 输出(N×fin)
                      ↑                           ↓
                 [分频器(÷N)]  ←――――――――――― [缓冲输出]
```

**关键参数:**
- VCO频率范围: 1kHz ~ 8kHz
- 分频比N: 1, 2, 3, 4, 5 (通过74HC161控制)
- 环路滤波器: R=10kΩ, C=1μF

#### 2.2.2 环路滤波器设计
```
CD4046_PC1 → [R1=10kΩ] → [C1=1μF] → CD4046_VCO_IN
                 ↓
              [R2=1kΩ]
                 ↓
               [C2=0.1μF] → GND
```

#### 2.2.3 VCO频率控制
- R0 = 10kΩ (最小频率设置)
- C0 = 0.1μF (VCO时序电容)
- 频率范围: 1kHz ~ 8kHz

### 2.3 可编程增益放大器 (MCP4018T + LM324)

#### 2.3.1 数字电位器控制
```
MSP430_SDA → MCP4018T_SDA
MSP430_SCL → MCP4018T_SCL
```

**I2C地址:** 0x2F (默认)
**电阻范围:** 0 ~ 10kΩ (128步)

#### 2.3.2 可编程增益电路
```
PLL输出 → [R_fixed=1kΩ] → [LM324C非反相放大器] → 幅度可调输出
                              ↑
                         [MCP4018T可变电阻]
                              ↓
                            GND
```

**增益计算:**
- G = 1 + (R_MCP4018T / R_fixed)
- 增益范围: 1 ~ 11倍
- 输出幅度: 根据增益调节实现1V, 2V, 3V输出

### 2.4 波形变换电路 (正弦波→三角波)

#### 2.4.1 积分器电路
```
正弦波输入 → [LM324D积分器] → 三角波输出
              ↑
         [R=10kΩ, C=0.01μF]
```

#### 2.4.2 波形选择开关
```
正弦波 ─┐
        ├→ [CD4052多路开关] → 输出选择
三角波 ─┘     ↑
           MSP430控制
```

### 2.5 相位检测电路

#### 2.5.1 双通道过零检测
```
X轴信号 → [LM324比较器1] → 数字信号X → MSP430_P1.0
Y轴信号 → [LM324比较器2] → 数字信号Y → MSP430_P1.1
```

#### 2.5.2 时间差测量
- 利用Timer_A捕获模式
- 测量两个过零点的时间差
- 计算相位差: Δφ = (Δt / T) × 360°

### 2.6 显示与控制电路

#### 2.6.1 LCD接口 (JLX12864G-086-PC)
```
MSP430_P2.0 → LCD_RS    (寄存器选择)
MSP430_P2.1 → LCD_RW    (读写控制)
MSP430_P2.2 → LCD_E     (使能信号)
MSP430_P1.0-P1.7 → LCD_D0-D7 (数据总线)
MSP430_P2.3 → LCD_CS1   (左半屏选择)
MSP430_P2.4 → LCD_CS2   (右半屏选择)
MSP430_P2.5 → LCD_RST   (复位信号)
```

#### 2.6.2 按键接口
```
MSP430_P1.3 → KEY1 (频率倍数调节)
MSP430_P1.4 → KEY2 (幅度调节)
MSP430_P1.5 → KEY3 (波形选择)
MSP430_P1.6 → KEY4 (菜单/确认)
```

## 3. 电源电路设计

### 3.1 电源分配
- VCC = +5V (主电源)
- VDD = +3.3V (MSP430电源)
- VREF = +1.65V (参考电压)

### 3.2 电源滤波
```
+5V → [L1=10μH] → [C1=100μF] → [C2=0.1μF] → 模拟电源
+5V → [L2=10μH] → [C3=100μF] → [C4=0.1μF] → 数字电源
```

## 4. PCB布局设计要点

### 4.1 模拟数字分离
- 模拟电路区域: 信号调理、PLL、增益控制
- 数字电路区域: MSP430、74HC系列、显示器
- 地平面分割: 模拟地和数字地在电源处单点连接

### 4.2 信号完整性
- 高频信号线短而直
- 差分信号等长布线
- 去耦电容靠近IC电源引脚
- 时钟信号远离敏感模拟电路

### 4.3 EMC设计
- 四层板设计: 顶层信号、地平面、电源平面、底层信号
- 关键信号线包地处理
- 晶振远离天线和敏感电路

## 5. 元器件清单

### 5.1 有源器件
| 器件型号 | 数量 | 功能 | 关键参数 |
|---------|------|------|----------|
| MSP430G2553 | 1 | 主控制器 | 16位, 16MHz, 16KB Flash |
| CD4046 | 1 | 锁相环 | 1kHz-8kHz VCO |
| LM324 | 2 | 四运放 | 单电源供电 |
| MCP4018T | 1 | 数字电位器 | I2C接口, 7位分辨率 |
| CD4052 | 1 | 双4选1开关 | 模拟开关 |
| 74HC00 | 1 | 四与非门 | 逻辑控制 |
| 74HC161 | 1 | 4位计数器 | 分频控制 |
| 2N2222 | 2 | NPN三极管 | 信号缓冲 |

### 5.2 无源器件
| 器件类型 | 规格 | 数量 | 用途 |
|---------|------|------|------|
| 电阻 | 1kΩ-100kΩ | 20+ | 偏置、分压、增益设置 |
| 电容 | 0.1μF-100μF | 15+ | 滤波、去耦、时序 |
| 电感 | 10μH | 2 | 电源滤波 |
| 晶振 | 16MHz | 1 | 系统时钟 |

## 6. 关键设计参数

### 6.1 PLL设计参数
- 锁定时间: < 1ms
- 相位噪声: < -60dBc/Hz @1kHz
- 频率精度: ±50Hz

### 6.2 增益控制精度
- 分辨率: 128步
- 线性度: < 1%
- 温度系数: < 100ppm/°C

### 6.3 相位测量精度
- 分辨率: 1°
- 重复精度: ±2°
- 线性度: < 1%

## 7. 仿真验证要点

### 7.1 Proteus仿真内容
1. PLL锁定特性验证
2. 增益控制线性度测试
3. 相位测量精度验证
4. 整体系统功能测试

### 7.2 关键波形观察
1. PLL输入/输出频率关系
2. 相位检测时序
3. ADC采样波形
4. LCD驱动时序