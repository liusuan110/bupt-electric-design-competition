# 2022年TI杯李萨如图形演示装置项目分析

## 项目概述

**项目名称**: 2022-Electric-Game-Lissajous-Figur  
**竞赛**: 2022年TI杯模拟电子系统设计专题邀请赛  
**主控**: MSP432P401R (ARM Cortex-M4F, 48MHz)  
**开发环境**: 支持Keil、CCS平台开发  
**项目特点**: 基于m-RNA开源的MSP432空工程开发，驱动完全独立打包

## 目录结构分析

```
2022-Electric-Game-Lissajous-Figur-main/
├── .vscode/                    # VS Code配置文件
├── hardware/                   # 硬件驱动模块
│   ├── inc/                   # 头文件目录
│   │   ├── adc.h             # ADC驱动头文件
│   │   ├── bmp.h             # 位图头文件
│   │   ├── key.h             # 按键驱动头文件
│   │   ├── key4x4.h          # 4x4键盘头文件
│   │   ├── led.h             # LED驱动头文件
│   │   ├── oled.h            # OLED显示头文件
│   │   ├── oledfont.h        # OLED字体头文件
│   │   ├── tim32.h           # 32位定时器头文件
│   │   └── timA.h            # Timer_A头文件
│   ├── adc.c                 # ADC采集驱动
│   ├── key.c                 # 独立按键驱动
│   ├── key4x4.c              # 4x4矩阵键盘驱动
│   ├── led.c                 # LED控制驱动
│   ├── oled.c                # OLED显示驱动
│   ├── tim32.c               # 32位定时器驱动
│   └── timA.c                # Timer_A驱动
├── LCD/                       # TFT LCD显示模块
│   ├── LCD_Display_API.c     # LCD显示API实现
│   ├── LCD_Display_API.h     # LCD显示API头文件
│   ├── LCD_eUSCI_B0_SPI.c    # LCD SPI底层驱动
│   ├── LCD_eUSCI_B0_SPI.h    # LCD SPI驱动头文件
│   ├── LCD_Font.c            # ASCII字库实现
│   └── LCD_Font.h            # 字库头文件
├── msp432p4xx_lib/           # MSP432官方库文件
├── project/                   # 项目工程文件
│   ├── ccs/                  # CCS工程配置
│   └── keil/                 # Keil工程配置
├── sys/                       # 系统级驱动
│   ├── inc/                  # 系统驱动头文件
│   │   ├── baudrate_calculate.h  # 波特率计算
│   │   ├── delay.h           # 延时函数
│   │   ├── sysinit.h         # 系统初始化
│   │   └── usart.h           # 串口通信
│   ├── baudrate_calculate.c  # 波特率计算实现
│   ├── delay.c               # 延时函数实现
│   ├── sysinit.c             # 系统初始化实现
│   └── usart.c               # 串口通信实现
├── main.c                     # 主程序文件
├── system_msp432p401r.c      # MSP432系统文件
└── README.md                  # 项目说明文档
```

## 核心功能模块分析

### 1. 主控制器 (MSP432P401R)

**技术规格**:
- **内核**: ARM Cortex-M4F (带浮点运算单元)
- **主频**: 48MHz (外部晶振)
- **Flash**: 256KB
- **SRAM**: 64KB
- **外设**: 丰富的模拟和数字外设

**时钟配置**:
```c
MCLK = 48MHz    // 主时钟
SMCLK = 48MHz   // 子系统时钟
LFXT = 32768Hz  // 低频时钟
```

### 2. 信号采集模块 (ADC)

**ADC配置**:
- **通道**: 双通道采集 (P5.4, P5.5)
- **分辨率**: 14位
- **时钟**: MCLK/4/2 = 2.4MHz
- **参考电压**: AVCC (3.3V)
- **采样模式**: 连续转换模式

**关键特性**:
- X轴、Y轴信号同步采集
- 1024点采样缓冲区
- 中断驱动采集
- 实时数据处理

### 3. 显示系统

#### 3.1 主显示器 - TFT LCD (320×240)
- **接口**: SPI (eUSCI_B0)
- **分辨率**: 320×240像素
- **颜色**: 16位真彩色
- **功能**: 李萨如图形实时显示

#### 3.2 参数显示器 - OLED
- **接口**: I2C
- **功能**: 参数设置和状态显示
- **应用**: 电压调节控制

### 4. 用户交互模块

**4×4矩阵键盘**:
- **功能映射**:
  - 按键1: 正弦波选择
  - 按键2: 三角波选择
  - 按键3,5,6,7,9: 频率倍数选择 (1-5倍)
  - 按键10,11: 电压调节 (±)
  - 按键13: 功能保留

### 5. 信号处理与控制

#### 5.1 模拟开关控制
**4052多路开关** (B->P2.3, A->P2.4):
- 波形选择控制

**4053多路开关** (C->P2.5, B->P2.6, A->P2.7):
- 信号路径选择

#### 5.2 频率倍数控制
**分频器控制** (N_or_1->P3.0, D2->P3.5, D1->P3.6, D0->P3.7):
- 4位数字控制分频比
- 支持1-5倍频率倍数

## 软件架构分析

### 1. 主程序流程 (main.c)

```c
int main(void)
{
    // 1. 系统初始化
    SysInit();              // 时钟配置 (48MHz)
    uart_init(115200);      // 串口初始化
    delay_init();           // 延时函数初始化
    KEY4x4_Init();          // 4x4键盘初始化
    
    // 2. GPIO配置
    // 模拟开关控制引脚
    // 分频器控制引脚
    
    // 3. LCD初始化
    LCD_SPI_Init();         // SPI接口初始化
    LCD_TFT_Init();         // TFT LCD初始化
    
    // 4. 界面绘制
    // 显示中文界面 (幅度、波形、频率倍数、电压调节值)
    
    // 5. ADC配置
    ADC_Config();
    
    // 6. 主循环
    while(1) {
        // 按键扫描和处理
        // 硬件控制输出
        // ADC数据处理
        // LCD图形绘制
        // 状态指示
    }
}
```

### 2. 按键控制逻辑

**波形选择**:
- 正弦波: waveform = 0
- 三角波: waveform = 1

**频率倍数控制**:
- 1-5倍: frequency = 1~5
- 对应不同的GPIO输出组合

**电压调节**:
- 通过I2C控制数字电位器
- 范围可调节

### 3. 信号处理流程

```c
// ADC中断处理
void ADC14_IRQHandler(void) {
    // 双通道数据采集
    X[ii] = resultsBuffer[0];  // X轴数据
    Y[ii] = resultsBuffer[1];  // Y轴数据
    ii++;
    
    if(ii >= 1024) {
        ADC_Flag = 0;  // 数据就绪标志
        ii = 0;
    }
}

// 主循环中的图形绘制
if(ADC_Flag == 0) {
    // 清屏操作
    if(tft_clean_cnt > 10) {
        LCD_TFT_fillrect(10, 10, 138, 138, White);
        tft_clean_cnt = 0;
    }
    
    // 绘制李萨如图形
    for(int j = 0; j < 1024; j++) {
        LCD_TFT_pixel(10 + X[j]/128, 10 + 128 - Y[j]/128, Blue);
    }
    
    ADC_Flag = 1;  // 重置标志
}
```

## 技术特点分析

### 1. 优势特性

✅ **高性能处理器**: MSP432P401R提供48MHz主频和硬件FPU  
✅ **双通道同步采集**: 实现X-Y轴信号的同步处理  
✅ **实时图形显示**: 1024点数据实时绘制李萨如图形  
✅ **完整的用户界面**: 中文显示界面，直观的参数设置  
✅ **模块化设计**: 硬件驱动完全封装，代码结构清晰  
✅ **多平台支持**: 支持Keil和CCS开发环境  

### 2. 关键算法

**坐标映射算法**:
```c
// ADC数据 (0-16383) 映射到显示坐标 (0-127)
x_pixel = 10 + X[j] / 128;           // X坐标映射
y_pixel = 10 + 128 - Y[j] / 128;     // Y坐标映射 (翻转Y轴)
```

**实时显示优化**:
- 采用双缓冲机制
- 周期性清屏避免拖尾
- 像素级精确绘制

### 3. 硬件控制策略

**分层控制架构**:
1. **信号选择层**: 4052/4053多路开关控制
2. **频率控制层**: 4位数字分频器控制
3. **幅度控制层**: I2C数字电位器控制

## 与我们设计的对比分析

### 相同点
- 都使用TI MSP系列微控制器
- 都实现李萨如图形实时显示
- 都支持频率倍数调节和波形选择
- 都采用LCD显示系统

### 不同点

| 特性 | 2022年项目 | 我们的设计 |
|------|------------|------------|
| **主控** | MSP432P401R (ARM M4F, 48MHz) | MSP430G2553 (16MHz) |
| **显示** | 320×240 TFT LCD | 128×64 LCD |
| **ADC** | 14位双通道同步 | 10位单通道 |
| **键盘** | 4×4矩阵键盘 | 4个独立按键 |
| **相位测量** | 未明确实现 | ±5°高精度算法 |
| **PLL** | 未使用 | CD4046 PLL频率合成 |
| **I2C设备** | OLED显示器 | MCP4018T数字电位器 |

### 技术改进建议

1. **相位测量精度**: 我们的设计在相位测量方面更加精确
2. **频率合成**: 使用CD4046 PLL提供更稳定的频率倍数
3. **成本控制**: MSP430方案成本更低，适合批量生产
4. **功耗优化**: MSP430系列功耗更低

## 参考价值

这个2022年的项目为我们提供了宝贵的参考：

1. **用户界面设计**: 中文界面的实现方式
2. **实时图形绘制**: 高效的像素绘制算法
3. **模块化架构**: 清晰的代码组织结构
4. **多开关控制**: 复杂信号路径的控制策略
5. **ADC处理**: 双通道同步采集的实现方法

## 结论

2022年的项目代表了较高的技术水准，特别是在显示效果和用户体验方面。我们的设计在保持核心功能的同时，针对成本和精度要求进行了优化，特别是在相位测量精度方面有显著提升。两个项目可以相互借鉴，形成更完善的解决方案。