# Proteus 原理图连接建议（MSP430G2553 Lissajous）

本文件给出实现赛题的关键连线与器件搭配，便于在 Proteus 中快速落图与调试。

## 核心模块
- MCU：MSP430G2553（DCO 16MHz 建议）
- LCD：JLX12864（常见 ST7920 控制器）SPI 三线接法
- 放大/偏置：LM324（多运放可用于缓冲、偏置、比较）
- 频率/倍频：CD4046（锁相），或 MCU 捕获周期替代
- 量程/幅度：CD4052（多路开关），MCP4018（数字电位器）
- 数模：PWM + RC 滤波（或 R-2R 简易 DAC）

## 信号链建议
1) X 轴输入
- X_in（2Vpp, 1.5–2kHz）→ LM324 缓冲与限幅 → 偏置至 Vref/2 → MCU ADC 输入（A0）
- 旁路 RC（例如 100nF 与 10k）形成抗混叠/去噪（按采样率调）

2) Y 轴生成与幅度控制
- MCU 产生 PWM（或 DDS 码流经 R-2R）→ RC 滤波成模拟 → LM324 跟随放大
- MCP4018（I2C）置于增益环路：实现 1/2/3 Vpp 程控；
- CD4052 切换量程/路径确保输出幅度达标

3) 倍频实现（两选一）
- 方案A：MCU 测频
  - X_in → LM324 比较整形 → MSP430 Timer_A Capture 口（P1.2/TA0.1 等）
  - MCU 根据 f_x 计算 f_y = N*f_x（N=1..5），驱动 DDS（`dds.c`）
- 方案B：CD4046 锁相
  - X_in → 4046 相位比较 → VCO 输出 → 74HC161 分频/倍频网络 → MCU 校正与波形生成

4) LCD（ST7920 SPI）
- SCLK→ P1.x，SID→ P1.y，E/RS→ P1.z（按实际引脚定）
- 供电、对比度、背光按 JLX 数据手册

5) I2C（MCP4018）
- SDA→ P1.7，SCL→ P1.6（示例），上拉 4.7k

6) 按键
- 三个：倍频选择、幅度选择、波形切换；下拉/上拉防抖

## 采样与相位
- 定时器触发 ADC 双通道（X/Y），或 X 由外部，Y 由数模回读到第二路 ADC 以测相
- 使用 `dsp_phase.c` 的 `phase_diff_deg_fs()`（传入 fs），在 N=128~256 样本下可达 ≤5°

## 参数建议（起步）
- fs = 20kHz；N=256；Hann 窗；零交叉估频 + Goertzel 相位
- PWM 频率 ≥ 200kHz，RC 截止 << PWM 但 >> 2kHz（折中，调试看噪声与幅度平直性）

## 备选方案
- 若 LCD 非 ST7920，则实现 `lcd.h` 接口的另一驱动（如 ST7565/KS0108）并替换编译单元
- 若不使用 MCP4018，可用 CD4052 多档分压 + MCU 校准查表
