# Proteus 原理图连接建议（MSP430G2553 Lissajous）

本文件给出实现2026年电子信息杯初赛李萨如图形演示装置的详细硬件选择与连线方案，结合2022年参考项目的成功经验进行优化设计。

## 1. 核心模块选型

### 1.1 主控制器
- **型号**: MSP430G2553 (PDIP-20)
- **时钟**: DCO 16MHz (满足实时相位测量要求)
- **资源**: 16KB Flash, 512B RAM (足够运行相位算法)
- **关键特性**: Timer_A捕获模式支持±5°相位测量精度

### 1.2 显示模块
- **型号**: JLX12864G-086-PC (128×64 LCD)
- **控制器**: ST7920兼容
- **接口**: SPI三线接法 (节省引脚)
- **背光**: 可选LED背光模块

### 1.3 模拟前端
- **运算放大器**: LM324 (四路运放包)
  - 功能1: X轴信号缓冲与调理
  - 功能2: Y轴信号放大与偏置
  - 功能3: 比较器整形 (相位测量)
  - 功能4: 备用/滤波器

### 1.4 频率合成模块
- **PLL芯片**: CD4046 (参考2022年项目)
- **分频器**: CD4018 或 74HC193 (可编程计数器)
- **VCO频率**: 设计覆盖1kHz-8kHz范围

### 1.5 幅度控制模块
- **数字电位器**: MCP4018T-104E/LT (I2C接口, 7位分辨率)
- **模拟开关**: CD4052 (双4选1开关) 用于1V/2V/3V量程切换
- **可编程增益**: 基于LM324运放 + MCP4018T

### 1.6 波形变换模块
- **三角波变换**: 积分器电路 (运放 + RC)
- **波形选择**: CD4052模拟开关切换

## 2. 详细信号链设计

### 2.1 X轴信号调理链
**输入**: 正弦波 (1-1.5kHz, 2Vpp)

```
X_IN → [前置保护] → [LM324A 缓冲] → [偏置至1.65V] → [抗混叠滤波] → MSP430 ADC (A0)
                                                                           ↓
                                  [LM324B 比较器] → [整形电路] → MSP430 P1.2 (Timer_A捕获)
```

**关键参数**:
- 输入阻抗: >10kΩ (避免信号源负载)
- 偏置电压: VCC/2 = 1.65V (ADC中点)
- 抗混叠: fc = 5kHz (10倍采样频率)
- 比较器阈值: 1.65V (过零检测)

### 2.2 Y轴信号生成链
**参考2022年项目的4052多路开关控制方案**

```
MSP430 PWM → [RC滤波] → [LM324C 跟随] → [MCP4018T 增益控制] → [CD4052 量程选择] → Y_OUT
    ↓                                            ↓                      ↓
Timer_A (1-5倍频)                        I2C控制(1-3V)             模拟开关控制
```

**量程配置**:
- 1V档: MCP4018T = 64/128, CD4052选择通道0
- 2V档: MCP4018T = 96/128, CD4052选择通道1  
- 3V档: MCP4018T = 128/128, CD4052选择通道2

### 2.3 波形变换电路
**基于2022年项目的模拟开关控制策略**

```
正弦波源 → [CD4052 A路] → 输出
           ↓
三角波变换 → [积分器] → [CD4052 B路] → 输出
```

**积分器设计**:
- 运放: LM324D
- 时间常数: τ = RC ≈ 100μs (适合1-2kHz)
- 增益补偿: 调整反馈电阻

### 2.4 PLL频率合成 (参考2022年设计)
**采用CD4046 + 可编程分频器方案**

```
X_IN → [整形] → CD4046相位比较器 → [环路滤波] → VCO → [分频器1-5] → Y频率基准
                      ↑                           ↓
                 [参考分频] ← ← ← ← ← ← ← ← [反馈分频]
```

**控制逻辑** (借鉴2022年4位数字控制):
- MSP430 P2.0-P2.3 → 74HC193计数器控制
- 分频比设置: 1x(0001), 2x(0010), 3x(0011), 4x(0100), 5x(0101)

## 3. MSP430G2553 引脚分配

### 3.1 系统引脚
| 功能 | 引脚 | 方向 | 备注 |
|------|------|------|------|
| VCC | 20 | 电源 | 3.3V |
| VSS | 19 | 地 | 数字地 |
| AVCC | 5 | 电源 | 模拟电源 |
| AVSS | 4 | 地 | 模拟地 |
| XOUT | 18 | 输出 | 外部晶振 (可选) |
| XIN | 17 | 输入 | 外部晶振 (可选) |

### 3.2 ADC与定时器引脚
| 功能 | 引脚 | GPIO | 备注 |
|------|------|------|------|
| X轴ADC | 2 | P1.0/A0 | X轴信号采集 |
| Y轴ADC | 3 | P1.1/A1 | Y轴反馈采集 |
| X轴捕获 | 8 | P1.2/TA0.1 | 频率/相位测量 |
| Y轴PWM | 7 | P1.6/TA0.1 | Y轴波形生成 |

### 3.3 SPI接口 (LCD ST7920)
| 功能 | 引脚 | GPIO | ST7920引脚 |
|------|------|------|-----------|
| SCLK | 15 | P1.5/UCB0CLK | E (时钟) |
| MOSI | 16 | P1.7/UCB0SIMO | R/W (数据) |
| CS | 6 | P1.3 | RS (片选) |

### 3.4 I2C接口 (MCP4018T)
| 功能 | 引脚 | GPIO | 备注 |
|------|------|------|------|
| SDA | 16 | P1.7 | 复用SPI引脚 |
| SCL | 15 | P1.6 | 复用SPI引脚 |

### 3.5 控制输出引脚
| 功能 | 引脚 | GPIO | 控制对象 |
|------|------|------|----------|
| PLL控制0 | 9 | P2.0 | 分频器D0 |
| PLL控制1 | 10 | P2.1 | 分频器D1 |
| PLL控制2 | 11 | P2.2 | 分频器D2 |
| PLL控制3 | 12 | P2.3 | 分频器D3 |
| 波形选择 | 13 | P2.4 | CD4052控制A |
| 量程选择0 | 14 | P2.5 | CD4052控制B |
| 量程选择1 | 1 | P1.4 | CD4052控制C |

### 3.6 用户接口
| 功能 | 引脚 | GPIO | 备注 |
|------|------|------|------|
| 按键1 | 8 | P1.2 | 频率倍数切换 |
| 按键2 | 7 | P1.6 | 幅度切换 |
| 按键3 | 6 | P1.3 | 波形切换 |
| 按键4 | 5 | P1.1 | 菜单/确认 |

## 4. 关键元器件规格与选型

### 4.1 运算放大器 LM324
**选择原因**: 单电源供电，四路运放，成本低
- **电源**: 3.3V单电源供电
- **增益带宽**: 1MHz (足够1-8kHz信号)
- **转换速率**: 0.5V/μs
- **应用**:
  - U1A: X轴信号缓冲器
  - U1B: 过零比较器 (相位测量)
  - U1C: Y轴信号放大器
  - U1D: 三角波积分器

### 4.2 锁相环 CD4046
**参考2022年项目的成功应用**
- **电源**: 3.3V CMOS兼容
- **VCO频率**: 由R1, R2, C1决定 (设计覆盖1-8kHz)
- **相位比较器**: 选择PC1 (异或型)
- **环路滤波**: R3=10kΩ, C2=1μF (锁定时间<1ms)

### 4.3 数字电位器 MCP4018T-104E/LT
**技术指标**:
- **阻值**: 10kΩ
- **分辨率**: 7位 (128步)
- **精度**: ±1LSB
- **接口**: I2C (地址0x2F)
- **温度系数**: ±100ppm/°C

### 4.4 模拟开关 CD4052
**应用场景**:
- **通道数**: 双4选1
- **导通电阻**: <200Ω
- **开关时间**: <1μs
- **控制逻辑**:
  - A, B控制位选择通道
  - INH使能控制

### 4.5 LCD JLX12864G-086-PC
**技术参数**:
- **分辨率**: 128×64点阵
- **控制器**: ST7920兼容
- **接口**: 串行/并行可选
- **电源**: 5V (需电平转换) 或 3.3V版本
- **背光**: LED, 约20mA

## 5. 电路连接详细说明

### 5.1 电源系统
**主电源**: 5V外部供电
```
5V_IN → [LM1117-3.3] → 3.3V_DIGITAL
     ↓
     [滤波电容] → 3.3V_ANALOG
```

**退耦电容配置**:
- MSP430: 100nF靠近VCC引脚
- LM324: 100nF + 10μF钽电容
- CD4046: 100nF
- 每个数字IC: 100nF

### 5.2 X轴信号调理详细连接

**LM324A 缓冲器**:
```
X_IN ──[1kΩ]──┬── LM324A(+)
              │
              └── [100nF] ── GND
              
LM324A(-) ── LM324A(OUT) ──[1kΩ]── X_BUFFERED
```

**偏置电路**:
```
3.3V ──[10kΩ]──┬── 1.65V_REF
               │
        [10kΩ] │
               ├── LM324B(+)
               │
               GND

X_BUFFERED ──[10kΩ]── LM324B(-) ── X_BIASED → MSP430 A0
```

**过零检测**:
```
X_BUFFERED ──[10kΩ]── LM324C(+)
                      │
1.65V_REF ────────── LM324C(-) ── ZERO_CROSS → MSP430 P1.2
```

### 5.3 Y轴信号生成详细连接

**PWM滤波**:
```
MSP430 P1.6 ──[1kΩ]──┬── [10nF] ── GND
                     │
                     └── LM324D(+)
                         │
                         LM324D(-) ── LM324D(OUT) ── Y_BASE
```

**幅度控制**:
```
Y_BASE ──[MCP4018T]──[10kΩ]── LM324C(+)
                              │
                              LM324C(-) ── LM324C(OUT) ── Y_AMPLITUDE
```

**量程选择**:
```
Y_AMPLITUDE ── CD4052(X0) ── Y_1V
               CD4052(X1) ── Y_2V (通过分压器)
               CD4052(X2) ── Y_3V (通过放大器)
```

### 5.4 PLL频率合成连接
**参考2022年项目的分频器控制方案**

```
ZERO_CROSS ── CD4046(PIN14 Sig_in)
              │
CD4046(PIN4 VCO_out) ── 74HC193(CLK)
                        │
MSP430 P2.0-P2.3 ── 74HC193(D0-D3) ── 分频输出 → Y轴频率参考
```

**VCO调谐电路**:
- R1 = 10kΩ (最小频率)
- R2 = 100kΩ (最大频率) 
- C1 = 1nF (频率范围调节)

### 5.5 LCD接口连接 (ST7920)

**3.3V供电版本**:
```
MSP430 P1.5 (UCB0CLK) ── LCD Pin5 (E)
MSP430 P1.7 (UCB0SIMO) ── LCD Pin6 (R/W)
MSP430 P1.3 ────────── LCD Pin4 (RS)
3.3V ───────────────── LCD Pin2 (VDD)
GND ────────────────── LCD Pin1 (VSS)
```

**5V供电版本需要电平转换**:
```
MSP430 ── [74LVC245] ── LCD (5V)
```

### 5.6 I2C连接 (MCP4018T)

```
MSP430 P1.7 (SDA) ──[4.7kΩ]── 3.3V
                   │
                   └── MCP4018T Pin6 (SDA)

MSP430 P1.6 (SCL) ──[4.7kΩ]── 3.3V  
                   │
                   └── MCP4018T Pin1 (SCL)

MCP4018T Pin2,3,4 ── GND (地址设置 = 0x2F)
```

## 6. 关键设计参数与调试要点

### 6.1 相位测量精度优化
**基于2022年项目经验改进**

**采样参数**:
- ADC采样率: 20kHz (10倍过采样)
- 捕获精度: Timer_A时钟 = 16MHz (62.5ns分辨率)
- 滤波算法: 移动平均 + 卡尔曼滤波

**理论精度分析**:
- 时间分辨率: 62.5ns
- 1kHz信号周期: 1ms = 360°
- 相位分辨率: 62.5ns/1ms × 360° = 0.0225°
- 考虑噪声裕量: 实际精度±2°

### 6.2 频率合成稳定性
**PLL环路设计**:
- 锁定时间: <1ms (满足快速响应)
- 相位噪声: <-60dBc/Hz @1kHz偏移
- 频率稳定度: ±10Hz (温度变化)

**调试方法**:
1. 先调试VCO覆盖范围
2. 优化环路滤波器参数
3. 验证锁定时间和稳定性

### 6.3 幅度控制线性度
**MCP4018T校准**:
- 端点校准: 0码和127码对应的输出电压
- 线性度检查: 中间码的输出线性度
- 温度补偿: 软件查表补偿

### 6.4 显示优化策略
**参考2022年项目的实时显示算法**

**坐标映射**:
```c
// ADC数据 (0-1023) 映射到显示坐标 (0-63)
x_pixel = (x_adc * 96) / 1024 + 16;  // 16像素边距
y_pixel = 32 - (y_adc * 32) / 512;  // Y轴翻转，中心对齐
```

**刷新策略**:
- 双缓冲显示避免闪烁
- 局部刷新减少计算量
- 轨迹淡化增强视觉效果

## 7. Proteus仿真验证要点

### 7.1 信号源设置
**X轴激励信号**:
- 波形: 正弦波
- 频率: 1kHz - 1.5kHz 可调
- 幅度: 2Vpp
- 偏置: 0V (AC耦合)

### 7.2 关键测试点
1. **X轴调理后信号**: 应为1.65V偏置的1Vpp信号
2. **过零检测输出**: 应为3.3V CMOS电平的方波
3. **PLL锁定指示**: CD4046 Pin1锁定检测
4. **Y轴输出幅度**: 1V/2V/3V精确控制
5. **相位差测量**: 软件算法验证

### 7.3 性能验证
- **频率精度**: Y轴频率 vs X轴频率的倍数关系
- **幅度精度**: 输出电压 vs 设定值误差<±0.1V
- **相位精度**: 测量误差<±5°
- **响应时间**: 参数切换后的稳定时间<100ms

### 7.4 仿真工具配置
**Proteus设置**:
- 仿真步长: 1μs (保证时序精度)
- 模型精度: 选择精确的SPICE模型
- 示波器观察: 关键节点波形
- 逻辑分析仪: 数字控制信号时序

**调试建议**:
1. 分模块验证 (先验证单个功能模块)
2. 信号链调试 (从输入到输出逐级检查)
3. 时序分析 (特别关注I2C和SPI时序)
4. 参数扫描 (验证频率和幅度调节范围)

## 8. 与2022年项目对比总结

### 8.1 借鉴的成功经验
✅ **4052模拟开关控制策略**: 用于量程和波形选择  
✅ **PLL + 分频器方案**: CD4046锁相环 + 可编程分频  
✅ **实时图形显示算法**: 坐标映射和双缓冲技术  
✅ **中文用户界面**: 参数显示和状态指示  
✅ **模块化驱动架构**: 硬件抽象层设计  

### 8.2 针对MSP430的优化改进
🔧 **相位测量算法**: 优化为±5°高精度算法  
🔧 **资源使用优化**: 适配MSP430有限的RAM/Flash  
🔧 **引脚复用策略**: I2C和SPI引脚复用设计  
🔧 **功耗管理**: MSP430低功耗特性应用  
🔧 **成本控制**: 简化外围电路，降低BOM成本  

### 8.3 创新设计点
🆕 **Timer_A捕获相位测量**: 利用MSP430特色功能  
🆕 **PWM + 数字滤波**: 替代复杂的DAC电路  
🆕 **软件校准算法**: 补偿硬件非线性误差  
🆕 **自适应显示**: 根据信号特性优化显示效果  

通过借鉴2022年项目的成功经验并结合MSP430的特色功能，本设计方案能够以更低的成本实现相同甚至更好的技术指标，特别是在相位测量精度方面有显著提升。
